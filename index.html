<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Netherlands stats</title>
    <script src="https://cdn.jsdelivr.net/npm/@javascript/danfojs@0.5.2/lib/bundle.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h2>Statistical Data Overview</h2>
        <p>This page displays economic indicators based on statistical data from the Dutch Central Bureau of Statistics (CBS). 
        These indices provide insights into monthly and annual changes, benchmarking against respective base years.</p>
    </header>

    <div class="container mt-4">

        <div class="row">
            <!-- Consumer Price Index -->
            <div class="col-lg-6 mb-4">
                <div class="card shadow">
                    <div class="card-body">
                        <h1 class="card-title">Consumer Price Index</h1>
                        <p class="card-text">index 2015=100</p>
                        <table id="CpiTable" class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Period</th>
                                    <th>Index</th>
                                    <th>Month mutation</th>
                                    <th>Year mutation</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
    
            <!-- Producer Price Index -->
            <div class="col-lg-6 mb-4">
                <div class="card shadow">
                    <div class="card-body">
                        <h1 class="card-title">Producer Price Index</h1>
                        <p class="card-text">index 2021=100</p>
                        <table id="PpiTable" class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Period</th>
                                    <th>Index</th>
                                    <th>Month mutation</th>
                                    <th>Year mutation</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
    
            <!-- Trade & Services Turnover Index -->
            <div class="col-lg-6 mb-4">
                <div class="card shadow">
                    <div class="card-body">
                        <h1 class="card-title">Trade & Services Turnover Index</h1>
                        <p class="card-text">index 2021=100</p>
                        <div class="table-responsive">
                            <table id="ServiceTable" class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Period</th>
                                        <th>Trade</th>
                                        <th>Transport & storage</th>
                                        <th>Catering</th>
                                        <th>Information & communication</th>
                                        <th>Real estate</th>
                                        <th>Services</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
    
            <!-- New Housing Price/Sale Index -->
            <div class="col-lg-6 mb-4">
                <div class="card shadow">
                    <div class="card-body">
                        <h1 class="card-title">New Housing Price/Sale Index</h1>
                        <p class="card-text">index 2020=100</p>
                        <div class="table-responsive">
                            <table id="HousingTable" class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Period</th>
                                        <th>Index</th>
                                        <th>Month change</th>
                                        <th>Year change</th>
                                        <th>Sold objects</th>
                                        <th>Year change</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>
    
    <footer>
        <p>Â© 2024 Iosefka (JC) management consulting services All Rights Reserved</p>
    </footer>

    <script>
        const CPI_metadata = {
            "odata.metadata": "https://opendata.cbs.nl/ODataApi/OData/83131NED/$metadata",
            "value": [
                { "name": "TableInfos", "url": "https://opendata.cbs.nl/ODataApi/odata/83131NED/TableInfos" },
                { "name": "UntypedDataSet", "url": "https://opendata.cbs.nl/ODataApi/odata/83131NED/UntypedDataSet" },
                { "name": "TypedDataSet", "url": "https://opendata.cbs.nl/ODataApi/odata/83131NED/TypedDataSet" },
                { "name": "DataProperties", "url": "https://opendata.cbs.nl/ODataApi/odata/83131NED/DataProperties" },
                { "name": "CategoryGroups", "url": "https://opendata.cbs.nl/ODataApi/odata/83131NED/CategoryGroups" },
                { "name": "Bestedingscategorieen", "url": "https://opendata.cbs.nl/ODataApi/odata/83131NED/Bestedingscategorieen" },
                { "name": "Perioden", "url": "https://opendata.cbs.nl/ODataApi/odata/83131NED/Perioden" }
            ]
        };

        const PPI_metadata = {
            "odata.metadata": "https://opendata.cbs.nl/ODataApi/OData/85771NED/$metadata",
            "value": [
                { "name": "TableInfos", "url": "https://opendata.cbs.nl/ODataApi/odata/85771NED/TableInfos" },
                { "name": "UntypedDataSet", "url": "https://opendata.cbs.nl/ODataApi/odata/85771NED/UntypedDataSet" },
                { "name": "TypedDataSet", "url": "https://opendata.cbs.nl/ODataApi/odata/85771NED/TypedDataSet" },
                { "name": "DataProperties", "url": "https://opendata.cbs.nl/ODataApi/odata/85771NED/DataProperties" },
                { "name": "CategoryGroups", "url": "https://opendata.cbs.nl/ODataApi/odata/85771NED/CategoryGroups" },
                { "name": "Afzet", "url": "https://opendata.cbs.nl/ODataApi/odata/85771NED/Afzet" },
                { "name": "AlleBedrijfstakken", "url": "https://opendata.cbs.nl/ODataApi/odata/85771NED/AlleBedrijfstakken" },
                { "name": "Perioden", "url": "https://opendata.cbs.nl/ODataApi/odata/85771NED/Perioden" }
                // B:minning(AlleBedrijfstakken=305700), C:industrie(AlleBedrijfstakken=307500), D:energy(AlleBedrijfstakken=346600), D:water/disposal(AlleBedrijfstakken=348000)
                // total = 300002
                // Afzet(A044075) = binnenland, Afzet(A044076) = buitenland
            ]
        };

        const Service_industry_metadata = {"odata.metadata": "https://opendata.cbs.nl/ODataApi/OData/85828NED/$metadata",
            "value": [
                {"name": "TableInfos","url": "https://opendata.cbs.nl/ODataApi/odata/85828NED/TableInfos"},
                {"name": "UntypedDataSet","url": "https://opendata.cbs.nl/ODataApi/odata/85828NED/UntypedDataSet"},
                {"name": "TypedDataSet","url": "https://opendata.cbs.nl/ODataApi/odata/85828NED/TypedDataSet"},
                {"name": "DataProperties","url": "https://opendata.cbs.nl/ODataApi/odata/85828NED/DataProperties"},
                {"name": "CategoryGroups","url": "https://opendata.cbs.nl/ODataApi/odata/85828NED/CategoryGroups"},
                {"name": "BedrijfstakkenBranchesSBI2008","url": "https://opendata.cbs.nl/ODataApi/odata/85828NED/BedrijfstakkenBranchesSBI2008"},
                {"name": "Perioden","url": "https://opendata.cbs.nl/ODataApi/odata/85828NED/Perioden"}
            ]
            };

        const new_housing_metadata = {
                "odata.metadata": "https://opendata.cbs.nl/ODataApi/OData/85773NED/$metadata",
                "value": [
                    {"name": "TableInfos", "url": "https://opendata.cbs.nl/ODataApi/odata/85773NED/TableInfos"},
                    {"name": "UntypedDataSet", "url": "https://opendata.cbs.nl/ODataApi/odata/85773NED/UntypedDataSet"},
                    {"name": "TypedDataSet", "url": "https://opendata.cbs.nl/ODataApi/odata/85773NED/TypedDataSet"},
                    {"name": "DataProperties", "url": "https://opendata.cbs.nl/ODataApi/odata/85773NED/DataProperties"},
                    {"name": "CategoryGroups", "url": "https://opendata.cbs.nl/ODataApi/odata/85773NED/CategoryGroups"},
                    {"name": "Perioden", "url": "https://opendata.cbs.nl/ODataApi/odata/85773NED/Perioden"}
                ]
            };
        
        // harmonized cpi
        // https://opendata.cbs.nl/statline/portal.html?_catalog=CBS&_la=nl&tableId=83135NED&_theme=387
        // employment per month 
        // https://opendata.cbs.nl/statline/portal.html?_catalog=CBS&_la=nl&tableId=83451NED&_theme=6
        // unemployment
        // https://opendata.cbs.nl/statline/#/CBS/nl/dataset/80590ned/table?ts=1730856004603
        // bankrupties
        // https://opendata.cbs.nl/statline/portal.html?_catalog=CBS&_la=nl&tableId=82242NED&_theme=42
        // producenten vertrouwen
        // https://opendata.cbs.nl/statline/portal.html?_catalog=CBS&_la=nl&tableId=81234ned&_theme=185
        // bevolking 
        // https://opendata.cbs.nl/statline/portal.html?_catalog=CBS&_la=nl&tableId=83474NED&_theme=62
        // woningen
        // https://opendata.cbs.nl/statline/portal.html?_catalog=CBS&_la=nl&tableId=85773NED&_theme=395 XXXX
        // bouwontwikkeling
        // https://opendata.cbs.nl/statline/portal.html?_catalog=CBS&_la=nl&tableId=85809NED&_theme=98
        // inputprijzen nieuwbouw
        // https://opendata.cbs.nl/statline/portal.html?_catalog=CBS&_la=nl&tableId=80444ned&_theme=393
        // inputprijzen per bouwtype 
        // https://opendata.cbs.nl/statline/portal.html?_catalog=CBS&_la=nl&tableId=83705NED&_theme=99
        // bouwvergunningen en nieuw/bestaande bouw 
        // https://opendata.cbs.nl/statline/portal.html?_catalog=CBS&_la=nl&tableId=83667NED&_theme=100
        // energy in kwh 
        // https://opendata.cbs.nl/statline/portal.html?_catalog=CBS&_la=nl&tableId=84575NED&_theme=125
        // producer sentiment 
        // https://opendata.cbs.nl/statline/portal.html?_catalog=CBS&_la=nl&tableId=81234ned&_theme=185
        // consumer sentiment 
        // https://opendata.cbs.nl/statline/portal.html?_catalog=CBS&_la=nl&tableId=83693NED&_theme=189
        // tourism 
        // https://opendata.cbs.nl/statline/portal.html?_catalog=CBS&_la=nl&tableId=82058NED&_theme=445

        

        // YEAR  
        function getYearArray() {
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear().toString();
            const lastYear = (currentDate.getFullYear() - 1).toString();
            const currentMonth = currentDate.getMonth(); // January is month 0
            return currentMonth === 0 ? [`${currentYear}`] : [`${currentYear}`, `${lastYear}`];
        }
        const yearArray = getYearArray();




        // testin ggettig the data sets  
        // const typedDataSetUrl = `${Service_industry_metadata.value.find(entity => entity.name === 'TypedDataSet').url}?$top=100`;
        // const typedDataSetUrl = `${Service_industry_metadata.value.find(entity => entity.name === 'TypedDataSet').url}?$top=100&$filter=startswith(Perioden, '2024')`;
        const typedDataSetUrl = `${new_housing_metadata.value.find(entity => entity.name === 'TypedDataSet').url}?$top=100&$filter=startswith(Perioden, '2024') and BedrijfstakkenBranchesSBI2008 eq '354200 '`;
        fetch(typedDataSetUrl, {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'}
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            // console.log("FETCHFETCH:", data.value.slice(0, 5)); // Display first 5 entries as sample
            console.log("FETCHFETCH:", JSON.stringify(data.value.slice(0, 100), null, 2));
        })




//  -----------------------------------------------------------------------------------------------------------
//  CPI -------------------------------------------------------------------------------------------  
//  -----------------------------------------------------------------------------------------------------------  
        function getTypedDataSetUrl_CPI(years, category, metadata) {
            // Create a dynamic filter based on the years provided
            const yearFilters = years.map(year => `substringof('${year}', Perioden)`).join(' or ');
            const categoryFilter = `Bestedingscategorieen eq '${category}'`;
            const filter = `${yearFilters} and ${categoryFilter}`;
            // Construct the final URL
            const typedDataSetUrl = metadata.value.find(entity => entity.name === 'TypedDataSet').url + 
                `?$filter=${filter}&$orderby=Perioden`; // Change ordering and top values as needed
            return typedDataSetUrl;
        }

        function CPI_populateTable(data, tableName) {
            const tableBody = document.querySelector(`#${tableName} tbody`);
            // Clear the existing table rows
            tableBody.innerHTML = '';
            // Loop through each item and create a row with the required columns
            data.forEach(item => {
                const row = document.createElement("tr");
                // Create cells for each column
                const periodCell = document.createElement("td");
                periodCell.textContent = item.Perioden;
                row.appendChild(periodCell);
                const cpiCell = document.createElement("td");
                cpiCell.textContent = item.CPI_1;
                row.appendChild(cpiCell);
                const maandmutatieCell = document.createElement("td");
                maandmutatieCell.textContent = item.MaandmutatieCPI_3;
                row.appendChild(maandmutatieCell);
                const jaarmutatieCell = document.createElement("td");
                jaarmutatieCell.textContent = item.JaarmutatieCPI_5;
                row.appendChild(jaarmutatieCell);
                // Append the row to the table body
                tableBody.appendChild(row);
            });
        }

        async function fetchTypedDataSet(years, category, html_table, metaTable) {
            const typedDataSetUrl = getTypedDataSetUrl_CPI(years, category, metaTable);
            try {
                const response = await fetch(typedDataSetUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                // Filter out entries where Perioden ends with "00"
                const filteredData = data.value.filter(item => !item.Perioden.endsWith('00')).reverse().slice(0, 12);       
                // console.log('Fetched Data:', JSON.stringify(filteredData, null, 2)); // Log the fetched data

                // Populate the table with filtered data
                if (html_table=="CpiTable") {
                    CPI_populateTable(filteredData, html_table);
                }
            } catch (error) {
                console.error('Error fetching TypedDataSet:', error);
                }
        }
        // Example usage
        fetchTypedDataSet(yearArray, 'T001112  ', "CpiTable", CPI_metadata); 








//  -----------------------------------------------------------------------------------------------------------
//  Service -------------------------------------------------------------------------------------------  
//  -----------------------------------------------------------------------------------------------------------  
    function getTypedDataSetUrl_Service(years, AlleBedrijfstakken, metadata) {
        // Create a dynamic filter based on the years provided
        const yearFilters = years.map(year => `substringof('${year}', Perioden)`).join(' or ');
        // const btak = `BedrijfstakkenBranchesSBI2008 eq '${AlleBedrijfstakken.join(",")}'`;
        const btak = `BedrijfstakkenBranchesSBI2008 eq '${AlleBedrijfstakken.join("' or BedrijfstakkenBranchesSBI2008 eq '")}'`;
        // const afzetFilter = `Afzet eq '${Afzet.join(",")}'`; 
        const filter = `${yearFilters} and ${btak}`;
        const typedDataSetUrl = metadata.value.find(entity => entity.name === 'TypedDataSet').url + 
            `?$filter=${filter}&$orderby=Perioden`; // Change ordering and top values as needed
        return typedDataSetUrl;
    }
    // const datadata = getTypedDataSetUrl_Service(['2024', '2023'], ['354200'], Service_industry_metadata);

    function Service_populateTable(data, tableName) {
        const tableBody = document.querySelector(`#${tableName} tbody`);
        tableBody.innerHTML = '';
        const periods = {}; // Object to store data by period

        // Initialize the structure for each period
        data.forEach(item => {
            if (!periods[item.Perioden]) {
                periods[item.Perioden] = {
                    "354200": null,
                    "383100": null,
                    "389100": null,

                    "391600": null,
                    "402000": null,
                    "B000655": null,
                    "410200": null
                };
            }
            // Assign values to the respective sectors
            if (item.BedrijfstakkenBranchesSBI2008.trim() === "354200") {
                periods[item.Perioden]["354200"] = item.Ongecorrigeerd_1;
            } else if (item.BedrijfstakkenBranchesSBI2008.trim() === "383100") {
                periods[item.Perioden]["383100"] = item.Ongecorrigeerd_1;
            } else if (item.BedrijfstakkenBranchesSBI2008.trim() === "389100") {
                periods[item.Perioden]["389100"] = item.Ongecorrigeerd_1;
            }

            else if (item.BedrijfstakkenBranchesSBI2008.trim() === "391600") {
                periods[item.Perioden]["391600"] = item.Ongecorrigeerd_1;
            }
            else if (item.BedrijfstakkenBranchesSBI2008.trim() === "402000") {
                periods[item.Perioden]["402000"] = item.Ongecorrigeerd_1;
            }
            else if (item.BedrijfstakkenBranchesSBI2008.trim() === "B000655") {
                periods[item.Perioden]["B000655"] = item.Ongecorrigeerd_1;
            }
            else if (item.BedrijfstakkenBranchesSBI2008.trim() === "410200") {
                periods[item.Perioden]["410200"] = item.Ongecorrigeerd_1;
            }

        });
        console.log(periods);
        // Convert periods object to an array and get the last 12 entries
        const last12Entries = Object.entries(periods).slice(0,12);

        // Populate the table rows
        for (const [period, values] of last12Entries) {
            const row = document.createElement("tr");
            const periodCell = document.createElement("td");
            periodCell.textContent = period; // Add period
            row.appendChild(periodCell);

            // Add cells for each sector
            row.appendChild(createCell(values["354200"]));
            row.appendChild(createCell(values["383100"]));
            row.appendChild(createCell(values["389100"]));

            row.appendChild(createCell(values["391600"]));
            row.appendChild(createCell(values["402000"]));
            row.appendChild(createCell(values["410200"]));
            row.appendChild(createCell(values["B000655"]));

            tableBody.appendChild(row);
        }
    }

    // Helper function to create a table cell
    function createCell(value) {
        const cell = document.createElement("td");
        cell.textContent = value !== null ? value : ""; 
        return cell;
    }

    async function Service_fetchTypedDataSet(years, AlleBedrijfstakken, html_table, metaTable) {
        const typedDataSetUrl = getTypedDataSetUrl_Service(years, AlleBedrijfstakken, metaTable);
        try {
            const response = await fetch(typedDataSetUrl, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            });
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            // Filter out entries where Perioden ends with "00" and others as needed
            const filteredData = data.value
                .filter(item => 
                    !item.Perioden.endsWith('00') &&
                    !(item.Perioden.charAt(4) === 'K'))
                .reverse();
                // .slice(0, 12);
            // console.log(filteredData);
            Service_populateTable(filteredData, html_table);
        } catch (error) {
            console.error('Error fetching TypedDataSet:', error);
        }
    }

    // Fetch data for the specified sectors
    Service_fetchTypedDataSet(yearArray, ['354200 ', '383100 ', '389100 ','391600 ','402000 ','410200 ','B000655'], "ServiceTable", Service_industry_metadata);





//  -----------------------------------------------------------------------------------------------------------
//  Housing -------------------------------------------------------------------------------------------  
//  -----------------------------------------------------------------------------------------------------------  
    function getTypedDataSetUrl_Housing(years, category, metadata) {
            // Create a dynamic filter based on the years provided
            const yearFilters = years.map(year => `substringof('${year}', Perioden)`).join(' or ');
            // const categoryFilter = `Bestedingscategorieen eq '${category}'`;
            // const filter = `${yearFilters} and ${categoryFilter}`;
            const filter = `${yearFilters}`;
            // Construct the final URL
            const typedDataSetUrl = metadata.value.find(entity => entity.name === 'TypedDataSet').url + 
                `?$filter=${filter}&$orderby=Perioden`; // Change ordering and top values as needed
            return typedDataSetUrl;
        }

        function Housing_populateTable(data, tableName) {
            const tableBody = document.querySelector(`#${tableName} tbody`);
            // Clear the existing table rows
            tableBody.innerHTML = '';
            // Loop through each item and create a row with the required columns
            data.forEach(item => {
                const row = document.createElement("tr");
                // Create cells for each column
                const periodCell = document.createElement("td");
                periodCell.textContent = item.Perioden;
                row.appendChild(periodCell);
                const indexCell = document.createElement("td");
                indexCell.textContent = item.PrijsindexVerkoopprijzen_1;
                row.appendChild(indexCell);
                const maandmutatieCell = document.createElement("td");
                maandmutatieCell.textContent = item.OntwikkelingTOVVoorgaandePeriode_2;
                row.appendChild(maandmutatieCell);
                const jaarmutatieCell = document.createElement("td");
                jaarmutatieCell.textContent = item.OntwikkelingTOVEenJaarEerder_3;
                row.appendChild(jaarmutatieCell);

                const objects_sale_Cell = document.createElement("td");
                objects_sale_Cell.textContent = item.VerkochteWoningen_4;
                row.appendChild(objects_sale_Cell);
                const objects_jaarmutatieCell = document.createElement("td");
                objects_jaarmutatieCell.textContent = item.OntwikkelingTOVEenJaarEerder_6;
                row.appendChild(objects_jaarmutatieCell);
                // Append the row to the table body
                tableBody.appendChild(row);
            });
        }

        async function Housing_fetchTypedDataSet(years, category, html_table, metaTable) {
            const typedDataSetUrl = getTypedDataSetUrl_Housing(years, category, metaTable);
            try {
                const response = await fetch(typedDataSetUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                const filteredData = data.value
                .filter(item => 
                    !item.Perioden.endsWith('00') &&
                    !(item.Perioden.charAt(4) === 'K'))
                .reverse()
                .slice(0,12);

                Housing_populateTable(filteredData, html_table);
                
            } catch (error) {
                console.error('Error fetching TypedDataSet:', error);
                }
        }
        // Example usage
        Housing_fetchTypedDataSet(yearArray, 'T001112  ', "HousingTable", new_housing_metadata); 
    </script>


<script type="module">
    import { PPI_fetchTypedDataSet } from './myfuncs.js';
    PPI_fetchTypedDataSet(yearArray,['300002'],['A044074'], "PpiTable", PPI_metadata); 
</script>



</body>
</html>
